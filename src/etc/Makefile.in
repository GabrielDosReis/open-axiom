INTERPSYS= \
	AXIOM="$(AXIOM)" \
	DAASE="$(axiom_src_datadir)" \
	../interp/interpsys$(EXEEXT)

subdir = src/etc/

pamphlets = Makefile.pamphlet $(asq_SOURCES)


.PHONY: all all-asq
all: all-ax

all-ax all-asq: stamp
	@echo finished $(builddir)

stamp: $(axiom_targetdir)/algebra/*.daase $(axiom_target_bindir)/asq$(EXEEXT) \
		$(axiom_target_libdir)/summary \
		$(axiom_target_libdir)/copyright
	-rm -f stamp
	$(STAMP) stamp

$(axiom_targetdir)/algebra/*.daase: ../algebra/*.NRLIB/code.$(OBJEXT)
	@ echo 4 rebuilding databases...
	@ $(INSTALL_DATA) $(axiom_src_docdir)/gloss.text ../algebra
	@ $(INSTALL_DATA) $(axiom_src_docdir)/gloss.text ../algebra
	@ $(INSTALL_DATA) $(axiom_src_docdir)/topics.data ../algebra
	@ $(INSTALL_DATA) $(axiom_src_docdir)/topics.data ../algebra
	@ (cd ../algebra ; \
           echo ')lisp (make-databases "" nil)' | ${INTERPSYS} )
	@ $(INSTALL_DATA) ../algebra/*.daase $(axiom_targetdir)/algebra
	@ $(INSTALL_DATA) ../algebra/libdb.text $(axiom_targetdir)/algebra
	@ $(INSTALL_DATA) ../algebra/comdb.text $(axiom_targetdir)/algebra

bin_PROGRAMS = asq$(EXEEXT)
asq_sources = asq.c
asq_SOURCES = $(addsuffix .pamphlet, $(asq_sources))
asq_objects = $(asq_sources:.c=.$(OBJEXT))

$(axiom_target_bindir)/asq$(EXEEXT): asq.c $(axiom_c_macros_h)
	@echo 4 making $@ from $<
	${CC} ${CCF} $(axiom_includes) -o asq asq.c
	$(INSTALL_PROGRAM) asq $(axiom_target_bindir)

asq.c: $(srcdir)/asq.c.pamphlet
	$(axiom_build_document) --tangle --output=$@ $<
$(axiom_target_libdir)/summary: $(srcdir)/summary
	$(INSTALL_DATA) $< $@ 

$(axiom_target_libdir)/copyright: $(srcdir)/copyright
	$(INSTALL_DATA) $< $@ 


mostlyclean-local:
	-rm -f $(asq_sources) $(asq_objects)
	-rm -f stamp

clean-local: mostlyclean-local
	-rm -f $(axiom_target_libdir)/summary
	-rm -f $(axiom_target_libdir)/copyright
	-rm -f $(axiom_target_bindir)/axiom
	-rm -f $(axiom_target_bindir)/asq$(EXEEXT)

distclean-local: clean-local
