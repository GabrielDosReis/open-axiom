core_sources = bsdsignal.c cfuns-c.c sockio-c.c
terminal_io_sources = cursor.c edin.c fnct_key.c openpty.c prt.c wct.c
graphics_sources = \
		halloc.c \
		hash.c \
		pixmap.c \
		spadcolors.c \
		util.c \
		XDither.c \
		XShade.c \
		XSpadFill.c

libspad_la_sources = $(foreach comp, \
			 $(addsuffix _sources, @axiom_c_runtime@), \
			 $($(comp)))

libspad_la_SOURCES = $(addsuffix .pamphlet,$(libspad_la_sources))

other_sources = cfuns-c.c

other_SOURCES = $(addsuffix .pamphlet,$(other_sources))

unused_sources = emupty.c

libspad_la_objects = $(libspad_la_sources:.c=.lo)

other_objects = $(other_sources:.c=.$(OBJEXT))

pamphlets = Makefile.pamphlet $(libspad_la_SOURCES) $(other_SOURCES)

subdir = src/lib/

.PHONY: all all-lib
.SUFFIXES:
.SUFFIXES: .o .lo .obj .c .h

all: all-ax

all-ax all-lib: stamp
stamp: $(axiom_target_libdir)/libspad.la
	rm -f stamp
	$(STAMP) stamp

$(axiom_target_libdir)/libspad.la: $(libspad_la_objects)
	$(mkinstalldirs) $(axiom_target_libdir)
	$(LIBTOOL) --mode=link $(CC) -o $@ $(libspad_la_objects) \
		-rpath $(libdir)/axiom/target/$(target)/lib

.PRECIOUS: %.c

%.c: $(srcdir)/%.c.pamphlet
	$(axiom_build_document) --tangle --output=$@ $<

.PRECIOUS: %.$(OBJEXT) %.lo

%.lo: %.c $(axiom_c_macros_h)
	$(COMPILE) -o $@ $(CCF) $(axiom_includes) $(AXIOM_X11_CFLAGS) $<

# This is a support library, so it does not change often and
# we don't need to remove the produced objects in mostlyclean.
# The remoal is done by clean.
mostlyclean-local:
	@rm -f *.lo *.$(OBJEXT)

clean-local: mostlyclean-local
	@$(LIBTOOL) --mode=clean $(axiom_target_libdir)/libspad.la
	@rm -f $(other_objects)
	@rm -f $(libspad_la_sources) $(other_sources)
	@rm -fr .libs _libs
	@rm -f stamp

distclean-local: clean-local
